# A-PCO智能交易系统Rust重构原子任务文档

## 1. 项目初始化与基础架构

### 1.1 项目目录结构搭建
- **任务描述**：创建标准Rust项目结构，配置Cargo.toml，设置Git版本控制
- **TDD优先**：无需测试用例，直接搭建基础架构
- **核心逻辑**：确保项目结构清晰，依赖配置正确
- **性能要求**：无特殊性能要求
- **验收标准**：项目能正常构建，Git仓库初始化完成

### 1.2 核心类型定义
- **任务描述**：定义基础数据结构，实现数据导向设计的紧凑结构体
- **TDD优先**：编写类型测试用例，验证内存布局和序列化
- **核心逻辑**：使用#[repr(C)]确保内存紧凑，实现零拷贝数据传递
- **性能要求**：结构体内存布局优化，减少缓存未命中
- **验收标准**：所有类型测试通过，内存布局符合预期

## 2. 感知层 (P1/P2) - 核心计算与特征提取

### 2.1.1 FeatureExtractor - 香农熵计算
- **任务描述**：实现高性能定制化香农熵计算，支持SIMD加速
- **TDD优先**：编写香农熵测试用例，验证计算准确性和SIMD加速性能
- **核心逻辑**：$H(X) = - \sum_{i=1}^{n} p_i \log_2(p_i)$，使用std::arch Intrinsics加速
- **性能要求**：纳秒级计算，零拷贝数据处理
- **验收标准**：测试用例通过，SIMD加速比≥2

### 2.1.2 FeatureExtractor - 傅里叶变换
- **任务描述**：实现高性能定制化傅里叶变换，支持SIMD加速
- **TDD优先**：编写傅里叶变换测试用例，验证频谱分析正确性和SIMD加速性能
- **核心逻辑**：FFT算法，使用std::arch Intrinsics加速
- **性能要求**：纳秒级计算，零拷贝数据处理
- **验收标准**：测试用例通过，SIMD加速比≥2

### 2.1.3 FeatureExtractor - 移动双均线
- **任务描述**：实现高性能定制化移动双均线，支持增量计算
- **TDD优先**：编写移动双均线测试用例，验证增量计算准确性
- **核心逻辑**：$\text{EMA}_t = (V_t \times \alpha) + (\text{EMA}_{t-1} \times (1-\alpha))$，O(1)复杂度
- **性能要求**：纳秒级计算，零拷贝数据处理
- **验收标准**：测试用例通过，增量计算正确性100%

### 2.1.4 FeatureExtractor - ATR/CKS趋势强度
- **任务描述**：实现高性能定制化ATR/CKS趋势强度因子
- **TDD优先**：编写ATR/CKS测试用例，验证增量计算准确性
- **核心逻辑**：增量计算，O(1)复杂度
- **性能要求**：纳秒级计算，零拷贝数据处理
- **验收标准**：测试用例通过，增量计算正确性100%

### 2.1.5 FeatureExtractor - 黑天鹅监测因子
- **任务描述**：实现瞬时熵增和归一化跳空因子，用于黑天鹅事件监测
- **TDD优先**：编写黑天鹅因子测试用例，验证计算准确性
- **核心逻辑**：瞬时熵增$\frac{\Delta H}{\Delta t}$，归一化跳空$\text{Gap} = \frac{|\text{Close}_{t-1} - \text{Open}_t|}{\text{ATR}_T}$
- **性能要求**：纳秒级计算，零拷贝数据处理
- **验收标准**：测试用例通过，计算准确性100%

### 2.1.6 FeatureExtractor - GARCH波动率预测
- **任务描述**：实现轻量级GARCH(1,1)模型，用于波动率预测
- **TDD优先**：编写GARCH测试用例，验证波动率预测准确性
- **核心逻辑**：GARCH(1,1)模型，轻量级实现
- **性能要求**：纳秒级计算，零拷贝数据处理
- **验收标准**：测试用例通过，预测准确性符合预期

### 2.1.7 ValidationEngine - 零拷贝数据流
- **任务描述**：实现高性能定制化验证引擎，支持零拷贝数据流
- **TDD优先**：编写ValidationEngine测试用例，验证零拷贝数据流和异步集成能力
- **核心逻辑**：使用Slice(&[T])实现零拷贝，异步集成到RealTimeExecutor
- **性能要求**：零拷贝数据处理，低延迟异步通信
- **验收标准**：测试用例通过，零拷贝验证通过

### 2.1.8 ValidationEngine - Calmar比率计算
- **任务描述**：实现高性能Calmar比率计算，支持过拟合检测
- **TDD优先**：编写Calmar比率测试用例，验证计算准确性和过拟合检测能力
- **核心逻辑**：$\text{Calmar Ratio} = \frac{\text{CAGR}}{\text{MDD}}$，MDD计算$\max_{t \in [0, T]} \left(\frac{\text{Peak}_t - \text{Valley}_t}{\text{Peak}_t}\right)$
- **性能要求**：毫秒级计算，支持大规模数据
- **验收标准**：测试用例通过，Calmar比率计算准确性100%

### 2.1.9 BoxTheoryAnalyzer - 支撑阻力位识别
- **任务描述**：实现高性能定制化箱体理论分析器，实时识别支撑阻力位
- **TDD优先**：编写BoxTheoryAnalyzer测试用例，验证实时、低延迟地识别支撑/阻力位的准确性
- **核心逻辑**：支撑位$\text{Support} (L) = \min_{t \in [t-T, t]} \text{Low}_t$，阻力位$\text{Resistance} (H) = \max_{t \in [t-T, t]} \text{High}_t$
- **性能要求**：微秒级计算，零拷贝数据传递
- **验收标准**：测试用例通过，支撑阻力位识别准确性≥95%

## 3. 决策层 (P2/P3) - 优化与体制识别

### 3.1.1 KNNRegimeClassifier - 分类与置信度
- **任务描述**：实现高性能KNN体制识别器，输出信号置信度
- **TDD优先**：编写KNNRegimeClassifier测试用例，验证分类准确性和置信度计算
- **核心逻辑**：手写K-NN算法，SIMD/并行加速，输出信号置信度
- **性能要求**：毫秒级分类判断，低内存消耗
- **验收标准**：测试用例通过，分类准确率≥90%，置信度计算准确性≥95%

### 3.1.2 AntColonyOptimizer - ACO算法
- **任务描述**：实现高性能定制化蚁群优化算法，最大化Calmar比率
- **TDD优先**：编写AntColonyOptimizer测试用例，验证ACO算法与Calmar比率优化
- **核心逻辑**：适应度函数最大化Calmar比率，信息素更新$\tau_{xy}(t+1) = (1-\rho) \tau_{xy}(t) + \sum_{k=1}^{m} \Delta \tau^k_{xy}$
- **性能要求**：多线程"飞蚁"并发搜索，低延迟优化
- **验收标准**：测试用例通过，Calmar比率≥5.26，无过拟合

### 3.1.3 AntColonyOptimizer - 鲁棒性评分
- **任务描述**：实现ACO优化过程中的鲁棒性评分计算
- **TDD优先**：编写鲁棒性评分测试用例，验证评分准确性
- **核心逻辑**：计算参数集在不同历史时间段内Calmar Ratio的稳定性
- **性能要求**：毫秒级计算，支持大规模数据
- **验收标准**：测试用例通过，鲁棒性评分计算准确性100%

### 3.1.4 BayesianOptimizer - 超参数优化
- **任务描述**：实现高性能贝叶斯优化器，用于超参数搜索
- **TDD优先**：编写BayesianOptimizer测试用例，验证超参数优化效率
- **核心逻辑**：高斯过程代理模型，期望改进采集函数$\text{EI}(\mathbf{x}) = E[\max(0, f(\mathbf{x}) - f(\mathbf{x}^+))]$
- **性能要求**：轻量级、非GC实现，快速评估
- **验收标准**：测试用例通过，超参数搜索效率≥传统网格搜索的5倍

## 4. 执行层 (P4) - 实时执行与OODA循环

### 4.1.1 RealTimeExecutor - 原子化交易执行
- **任务描述**：实现高性能实时执行引擎，支持原子化交易操作
- **TDD优先**：编写RealTimeExecutor测试用例，验证原子化平仓+反手开单操作
- **核心逻辑**：async/await异步执行，原子化交易操作
- **性能要求**：低延迟交易执行（<1ms）
- **验收标准**：测试用例通过，原子化操作成功率100%

### 4.1.2 RealTimeExecutor - KPI因子执行过滤
- **任务描述**：实现基于KPI因子的执行过滤逻辑
- **TDD优先**：编写KPI因子执行过滤测试用例，验证执行门限有效性
- **核心逻辑**：只有当$\text{KPI}_{\text{Confidence}} > \text{Threshold}$时，才允许指令执行
- **性能要求**：纳秒级判断，零延迟过滤
- **验收标准**：测试用例通过，KPI因子过滤准确性100%

### 4.1.3 OODA循环 - 状态机实现
- **任务描述**：实现高性能OODA循环，支持并发任务管理
- **TDD优先**：编写OODA循环测试用例，验证状态机转换和并发任务管理
- **核心逻辑**：基于enum和match的状态机，tokio任务并发管理
- **性能要求**：低延迟状态转换，高效并发管理
- **验收标准**：测试用例通过，状态转换准确性100%

## 5. 风控层 (P5/P6) - 风险控制与报告

### 5.1.1 RiskControl - 黑天鹅监测
- **任务描述**：实现高性能黑天鹅事件监测逻辑
- **TDD优先**：编写黑天鹅监测测试用例，验证异常信号检测准确性
- **核心逻辑**：基于瞬时熵增、归一化跳空和GARCH预测波动率的异常检测
- **性能要求**：微秒级监测，实时响应
- **验收标准**：测试用例通过，黑天鹅事件检测准确率≥95%

### 5.1.2 RiskControl - 反手开单策略
- **任务描述**：实现高性能反手开单决策逻辑
- **TDD优先**：编写反手开单测试用例，验证决策正确性
- **核心逻辑**：当黑天鹅事件触发且价格触及箱体边界时，执行平仓+反手开单
- **性能要求**：毫秒级决策，低延迟执行
- **验收标准**：测试用例通过，反手开单决策准确性≥90%

### 5.1.3 ReportingEngine - 性能指标计算
- **任务描述**：实现高性能性能指标计算，包括Calmar比率等
- **TDD优先**：编写性能指标测试用例，验证计算准确性
- **核心逻辑**：Calmar比率、MDD、R-Multiple等指标计算
- **性能要求**：毫秒级计算，支持大规模数据
- **验收标准**：测试用例通过，性能指标计算准确性100%

## 6. 集成与测试

### 6.1.1 模块集成测试
- **任务描述**：测试模块间接口兼容性和数据流转正确性
- **TDD优先**：编写模块集成测试用例，验证模块间交互
- **核心逻辑**：确保模块间数据传递正确，接口兼容
- **性能要求**：无特殊性能要求
- **验收标准**：所有集成测试通过

### 6.1.2 系统级性能测试
- **任务描述**：测试系统在高压力下的性能表现
- **TDD优先**：编写系统级性能测试用例，验证低延迟和高Calmar比率
- **核心逻辑**：模拟高压力市场环境，测试系统性能
- **性能要求**：系统在高压力下维持5.26 Calmar比率，延迟<1ms
- **验收标准**：系统级性能测试通过，满足所有性能指标

## TDD执行原则

1. **严格测试先行**：所有功能必须先编写可运行、可覆盖核心功能的测试文件
2. **原子任务开发**：一次只专注于一个任务，当前任务未通过测试前，严禁编写下一任务代码
3. **测试覆盖全面**：包括边界情况、异常情况和核心功能
4. **重构与质量检查**：测试通过后进行重构，并执行完整质量检查
5. **性能指标验证**：每个模块都要验证相关性能指标

## 质量保证

- **测试覆盖率**：100%核心功能覆盖
- **性能指标**：<1ms延迟，零GC压力，Calmar比率≥5.26
- **代码质量**：通过所有Rust clippy检查
- **安全审计**：使用cargo-audit检查依赖安全性
- **鲁棒性**：验证非过拟合解，适应不同市场环境